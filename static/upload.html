<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Material Design Bootstrap</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-default.min.css">
  <!-- Your custom styles (optional) -->
  <link href="css/style.css" rel="stylesheet">
  <link href="css/mygrid.css" rel="stylesheet">
  <link href="css/dragula.min.css" rel="stylesheet">
  <link href="css/kanban.css" rel="stylesheet">
</head>

<body>
  <div class="gridwrapper" id="gridwrapper">

      	
      	<div>
			<h3>Compress</h3>
			<small>Upload a uncompressed file and it will be compressed and downloaded!</small>
			<br />
			<input id="to-compress" type="file" />
			<div id="result"></div>
			<div>
				<small>Original Size: <span id="compress_original_size">n/a</span></small><br />
				<small>Compressed Size: <span id="compress_compressed_size">n/a</span></small>
			</div>
		</div>
      	
      	
  </div>

  <script src="https://unpkg.com/wasm-flate@0.1.11-alpha/dist/bootstrap.js"></script>
  <script>
  	document.querySelector('#to-compress').addEventListener('change', function(inp) {
        var reader = new FileReader();
        reader.onload = function() {
            console.log(inp.target.id)
            // if (inp.target.id == "to-compress") {
            console.log("Compressing")
            console.log(this.result.slice(0,1000));
            var arrayBuffer = this.result,
                array = new Uint8Array(arrayBuffer)
            var original_size = array.length
            document.getElementById("compress_original_size").textContent = original_size;
            // compress array 
            var array = flate.deflate_encode_raw(array)
            var compressed_size = array.length
            document.getElementById("compress_compressed_size").textContent = compressed_size;
            console.log(original_size, compressed_size)
            //var blob = new Blob([array], {});
            //link.href = window.URL.createObjectURL(blob);
            //var fileName = "compressed_file.comp";
            
            // }
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("POST", "/uploadfile", false); // false for synchronous request
            xmlHttp.send(array);
            console.log(xmlHttp.responseText);
            return xmlHttp.responseText;
        }
        reader.readAsArrayBuffer(this.files[0]);
    }, false);
  </script>

</body>

</html>
